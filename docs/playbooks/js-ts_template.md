Procedure: Environment setup You're working in the {FOLLOWING TYPESCRIPT REPO, which should already be cloned in ~/{REPO_NAME} of your computer. Ensure the environment is set up correctly: run yarn lint:tsc, and make sure that no errors are printed. If there are errors, report to the user. Switch to a new branch called devin/convert-ts-{filename}-$RANDOM, where filepath is the path of the file you're converting. You should literally use $RANDOM in the shell command so that you get a truly random branch name. First pass edits Convert the target file(s) to typescript: rename each one from .js to .ts or .tsx (if it contains a component). Make a commit for this "rename without changes" only. Run git show to double check that you did this right. Look at the file and analyze the following: All the types that can be immediately deduced from looking at the file directly vs. all the types for which you need to do information gathering. Make a first edit to apply all the changes for the types that you can immediately deduce from the file. Use unknown for any types that couldn't be immediately deduced. Don't try to guess these types before gathering the information. At the same time, note down all the types you need more information to deduce in ~/notes.md under TODOS: UNKNOWN TYPES. Be very descriptive in your edit actions and notes. Make a commit called "first pass: easy type deductions + unknown placeholder types" containing these changes. Report to the user all the types you were able to infer, any judgement calls that were made, and the unknown types that you'll fix in a follow-up, and then move on. Iterate over all the unknown types that you noted down; for each, do information gathering to figure out the appropriate type to use instead of unknown. Perform these edits. If any type is difficult to determine, it is fine to leave it as unknown; just add a comment explaining why it's difficult. Make a commit with these changes called "updating unknown types" Error fixing loop Run yarn lint:tsc. Add errors you didn't anticipate to ~/notes.md to a new section caleld TODOS: LINT & TSC ISSUES. Now in a loop go through every open issue you noted down in ~/notes.md. 8.1. First, decide whether the solution to the issue can be decided from just the file itself or whether it requires gathering context. 8.2. If it requires gathering context, first use <ask_expert> with the error to query your knowledge base for information. 8.3. If no results are found, jumping to another file or even multiple other files is necessary. Use commands like <gather_information>, <go_to_definition>, <go_to_references>, <find_filecontent>, and <find_filename>, which are helpful tools for exploration. For determining types, it can be helpful to look at upstream files (i.e. callsites) that pass in objects into the current file as well as downstream files that use objects passed through from the current file. 8.4. If after a few steps you still haven't successfully found the correct type, it is fine to give up and move on. Some types are very difficult to determine and require human input. In the third section in ~/notes.md, note down what was difficult. Then, make the best edit you can to silence the error, worst case you can just use @ts-expect-error . Send a quick message to the user about this and move on to step 8.6. 8.5. If you found the correct type, make the appropriate edit in the current file. Sometimes you need to edit other files to edit the issue. However you should think hard about whether those edits are reasonable or judgement calls that require human input. If it is a non-obvious judgement call, follow the instructions in Step 8.4 instead (note it down, report to the user, silence the error & move on). 8.6. Once you are done with all your TODOS in your ~/notes.md, go to the next step. Otherwise, go back to step 8 and fix them all. Now, re-run yarn lint:tsc and see if there are still errors. Update ~/notes.md to be up to date. If there are more errors, go back to step 8 and fix them all. Once you think you are done, make sure yarn lint:tsc and yarn lint finish without errors (ignore any warnings). Make a commit called "fix errors", if you made any changes. Preparing the Pull Request Review your cumulative diff. Make sure there are no semantic changes, and also no stray changes. Make sure there are no remaining unknowns left. Commit everything and share a preview of the diff against merge base in the chat, and wait for their response. Offer to make a draft PR & propose a title; it should begin with "chore(js-ts): Convert {{full_file_path}} to TypeScript". Don't actually open the PR yet since the user may have feedback. If the user approves, you should make the draft PR. Add the PR labels "needs-dev-review", "team-mobile-platform", "skip-sonar-cloud", and "Run Smoke E2E" Once you are done, commit your changes and stop. Do NOT push your code or make a pull request at this time.

Notes Use interface instead of type for props. Never install a new types library yourself. Instead note down & report to the user that you recommend installing types xyz AND declare the module in app/declarations/index.d.ts {CORRESPONDING_FILE} Use unknown for any type that you haven't handled yet. DO NOT just add any or guess types. propTypes are a good place to get hints, however, they aren't perfect. First of all, parameters declared in propTypes are not required by default. In most cases, it's correct to assume that parameters are not required â€“ but in many cases it's best to declare parameters as required. Moreover, for propType.func or propType.object, you should do information gathering first. DO NOT just put () => void or any. Make sure that propTypes are removed from the file at the end of the conversion process, if they were present to begin with. Do NOT use these types: Function: instead use arrow function types. Array: use [] types. any: use the most specific type you can. Avoid using object type unless necessary. Try to identify the correct type using information gathering. You are allowed to suppress errors from test files like index.test.ts{INSERT YOUR TEST FILE} with @ts-expect-error if you can't infer the correct type or cannot fix the type errors in those test files. Do NOT do explicit type annotation unless necessary. Do NOT make any semantic changes to the code. This includes: adding if statements, adding return statements, changing function parameter orders, etc. The only semantic change that's allowed is deleting PropTypes. Restrict yourself to only adding types -- interface definitions, type annotations, casts, ts-ignores, etc. Run git show after every commit to review your diff. Run git diff $(git merge-base HEAD origin/main) to review your cumulative diff. yarn lint and yarn lint:tsc sometimes take a while to complete. Wait up to 5 minutes for them to complete. Do NOT run yarn test or yarn install at this time. To repeat: do not make any semantic changes, even to test files. Your task is to do a pure refactor, so you must preserve the original semantics of the code as faithfully as possible to avoid introducing behavior changes.
